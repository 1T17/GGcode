# GGcode + CutViewer Integration Proposal

## Overview

Thank you for the interest in integrating GGcode with CutViewer! We can absolutely standardize on CutViewer's comment format while preserving GGcode's powerful programming capabilities. This integration would provide rich metadata to CutViewer without affecting the generated G-code compatibility.

---

## Current GGcode Syntax Example

```ggcode
// Professional Gear Generator
// Creates gears with proper involute tooth profiles

note {
  Professional Gear Generator
  Creates gears with proper involute tooth profiles
  Demonstrates: Advanced gear design with involute curves
  Author: GGcode Examples
  Version: 1.0
}

let id = 4453

// === Configurable Parameters ===
let center_x = 0 /// @number -50 50 // Center X coordinate
let center_y = 0 /// @number -50 50 // Center Y coordinate
let teeth_count = 64 /// @number 8 128 // Number of teeth
let module_size = 1.5 /// @number 0.5 5 // Module size (tooth size)
let pressure_angle_deg = 10 /// @number 14.5 25 // Pressure angle (degrees)
let feed_rate = 150 /// @number 50 300 // Feed rate in mm/min
let z_depth = -0.2 /// @number -5 0 // Z cutting depth
let z_safe = 1 /// @number 1 5 // Safe Z height

// === Calculated Gear Dimensions ===
let pressure_angle = pressure_angle_deg * DEG_TO_RAD
let pitch_radius = (module_size * teeth_count) / 2
let base_radius = pitch_radius * cos(pressure_angle)
let addendum = module_size
let dedendum = 1.25 * module_size
let outer_radius = pitch_radius + addendum
let root_radius = pitch_radius - dedendum

// === Cut shaft hole first ===
let shaft_radius = 40 /// @number 1 300 // shaft radius 
let shaft_steps = 100 

// === Move to safe height and center ===
G0 Z[z_safe]
G0 X[center_x] Y[center_y]
G0 X[center_x + shaft_radius] Y[center_y]
```

---

## Proposed CutViewer Integration

### 1. **CutViewer-Compatible Comments**

GGcode can generate CutViewer-standard comments while preserving its programming capabilities:

```ggcode
// CutViewer Integration Example
// (STOCK, X0, Y0, Z10, X100, Y100, Z0)
// (TOOL, 1, 6.35, 0, 0, 0)
// (PROGRAM, Gear Generator v1.0)
// (DESCRIPTION, Professional gear with involute tooth profiles)
// (PARAMETERS, teeth=64, module=1.5, pressure_angle=10)

let id = 4453

// === CutViewer Metadata ===
// (STOCK, X-50, Y-50, Z10, X50, Y50, Z-5)
// (TOOL, 1, 6.35, 0, 0, 0)
// (PROGRAM, GGcode Gear Generator)
// (DESCRIPTION, Involute gear with [teeth_count] teeth, [module_size]mm module)
// (PARAMETERS, center_x=[center_x], center_y=[center_y], teeth=[teeth_count])

// === Configurable Parameters ===
let center_x = 0 /// @number -50 50 // Center X coordinate
let center_y = 0 /// @number -50 50 // Center Y coordinate
let teeth_count = 64 /// @number 8 128 // Number of teeth
let module_size = 1.5 /// @number 0.5 5 // Module size (tooth size)
let pressure_angle_deg = 10 /// @number 14.5 25 // Pressure angle (degrees)
let feed_rate = 150 /// @number 50 300 // Feed rate in mm/min
let z_depth = -0.2 /// @number -5 0 // Z cutting depth
let z_safe = 1 /// @number 1 5 // Safe Z height

// === Tool Configuration ===
// (TOOL, 1, 6.35, 0, 0, 0) // 1/4" end mill
// (TOOL, 2, 3.175, 0, 0, 0) // 1/8" end mill for detail work

// === Calculated Dimensions ===
let pressure_angle = pressure_angle_deg * DEG_TO_RAD
let pitch_radius = (module_size * teeth_count) / 2
let base_radius = pitch_radius * cos(pressure_angle)
let addendum = module_size
let dedendum = 1.25 * module_size
let outer_radius = pitch_radius + addendum
let root_radius = pitch_radius - dedendum

// === Stock Definition ===
// (STOCK, X[center_x - outer_radius - 5], Y[center_y - outer_radius - 5], Z[z_safe], 
//         X[center_x + outer_radius + 5], Y[center_y + outer_radius + 5], Z[z_depth])

// === Move to safe height and center ===
G0 Z[z_safe]
G0 X[center_x] Y[center_y]
```

---

## Generated G-code Output

The GGcode compiler would generate CutViewer-compatible G-code:

```gcode
%
(File: Gear_Generator.gcode)
(Generated by: GGcode v1.0)
(Program: Professional Gear Generator)
(Description: Involute gear with 64 teeth, 1.5mm module)
(Parameters: center_x=0, center_y=0, teeth=64, module=1.5)
(STOCK, X-55, Y-55, Z1, X55, Y55, Z-0.2)
(TOOL, 1, 6.35, 0, 0, 0)
(TOOL, 2, 3.175, 0, 0, 0)
G21 G90 G94
G17
G28 Z0
G28 X0 Y0
G0 Z1
G0 X0 Y0
G0 X40 Y0
G1 Z-0.2 F150
G1 X39.9 Y0.6
G1 X39.6 Y1.2
...
```

---

## Integration Benefits

### **For CutViewer:**
- ✅ **Standard comment format** - Uses CutViewer's exact syntax
- ✅ **Rich metadata** - Stock size, tool info, program details
- ✅ **Parameter tracking** - Real-time parameter values in comments
- ✅ **Tool management** - Multiple tool definitions with proper numbering
- ✅ **3D preview compatibility** - Full CutViewer integration

### **For GGcode Users:**
- ✅ **Programming power** - Variables, loops, functions, math
- ✅ **Real-time parameter adjustment** - Interactive configurator
- ✅ **Complex geometry** - Involute curves, spirals, patterns
- ✅ **Error prevention** - Built-in validation and error checking
- ✅ **Professional output** - Production-ready G-code

---

## Tool Numbering Standard

Following the MakerForums standard, we can implement:

```ggcode
// === Tool Library ===
// (TOOL, 1, 6.35, 0, 0, 0)   // T1: 1/4" end mill - roughing
// (TOOL, 2, 3.175, 0, 0, 0)  // T2: 1/8" end mill - finishing  
// (TOOL, 3, 1.5875, 0, 0, 0) // T3: 1/16" end mill - detail
// (TOOL, 4, 0.79375, 0, 0, 0) // T4: 1/32" end mill - engraving
// (TOOL, 10, 3.175, 0, 0, 0) // T10: 1/8" ball nose - 3D carving
// (TOOL, 20, 6.35, 0, 0, 0)  // T20: 1/4" V-bit - V-carving

let current_tool = 1 /// @selection 1 2 3 4 10 20 // Select tool
let tool_diameter = 6.35 /// @number 0.5 25 // Tool diameter (mm)
```

---

## Implementation Approach

### **Phase 1: Comment Generation**
- Add CutViewer comment generation to GGcode emitter
- Support dynamic parameter interpolation in comments
- Maintain backward compatibility

### **Phase 2: Tool Management**
- Implement tool library system
- Add tool change commands (T1 M6)
- Support tool-specific parameters

### **Phase 3: Advanced Integration**
- Real-time parameter updates in CutViewer
- Live 3D preview with GGcode variables
- Direct GGcode → CutViewer workflow

---

## Example: Complete Integration

```ggcode
// CutViewer Integration - Professional Gear Generator
// (STOCK, X-60, Y-60, Z2, X60, Y60, Z-2)
// (TOOL, 1, 6.35, 0, 0, 0)
// (PROGRAM, GGcode Gear Generator v1.0)
// (DESCRIPTION, Involute gear with configurable parameters)
// (PARAMETERS, teeth=[teeth_count], module=[module_size], pressure_angle=[pressure_angle_deg])

let id = 4453

// === Configurable Parameters ===
let center_x = 0 /// @number -50 50 // Center X coordinate
let center_y = 0 /// @number -50 50 // Center Y coordinate
let teeth_count = 64 /// @number 8 128 // Number of teeth
let module_size = 1.5 /// @number 0.5 5 // Module size (tooth size)
let pressure_angle_deg = 10 /// @number 14.5 25 // Pressure angle (degrees)
let feed_rate = 150 /// @number 50 300 // Feed rate in mm/min
let z_depth = -0.2 /// @number -5 0 // Z cutting depth
let z_safe = 1 /// @number 1 5 // Safe Z height

// === Tool Configuration ===
let current_tool = 1 /// @selection 1 2 3 4 // Tool selection
let tool_diameter = 6.35 /// @number 0.5 25 // Tool diameter (mm)

// === Calculated Dimensions ===
let pressure_angle = pressure_angle_deg * DEG_TO_RAD
let pitch_radius = (module_size * teeth_count) / 2
let base_radius = pitch_radius * cos(pressure_angle)
let addendum = module_size
let dedendum = 1.25 * module_size
let outer_radius = pitch_radius + addendum
let root_radius = pitch_radius - dedendum

// === CutViewer Stock Update ===
// (STOCK, X[center_x - outer_radius - 10], Y[center_y - outer_radius - 10], Z[z_safe], 
//         X[center_x + outer_radius + 10], Y[center_y + outer_radius + 10], Z[z_depth])

// === Program Start ===
G21 G90 G94
G17
G28 Z0
G28 X0 Y0
T[current_tool] M6
G0 Z[z_safe]
G0 X[center_x] Y[center_y]

// === Gear Generation Logic ===
// ... rest of gear generation code ...
```

---

## Next Steps

1. **Standardize on CutViewer comment format** in GGcode emitter
2. **Implement tool numbering system** following MakerForums standard
3. **Add dynamic parameter interpolation** in CutViewer comments
4. **Test integration** with CutViewer 3D preview
5. **Document workflow** for users

This integration would provide the best of both worlds: GGcode's programming power with CutViewer's visualization capabilities, while maintaining full G-code compatibility.

Would you like to collaborate on implementing this integration? We can start with the comment generation and tool management features. 